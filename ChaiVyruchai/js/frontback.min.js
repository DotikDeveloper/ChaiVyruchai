document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("userPhoto"),t=document.getElementById("settings");t.onsubmit=async e=>{e.preventDefault();let n=await fetch("/",{method:"POST",body:new FormData(t)}),o=await n.json();if(t.reset(),"ok"==o.answer){let e=new FormData;e.append("get_data_user",""),fetch("/",{method:"POST",body:e}).then((function(e){return e.json()})).then((function(e){console.log(e.first_name),document.querySelector(".login__info--user-name").textContent=e.first_name}))}},e.addEventListener("change",()=>{n(e.files[0])});const n=t=>{if(console.log(t.name),!["image/jpeg","image/png","image/gif","image/svg+xml"].includes(t.type))return void alert("Допустимы изображения png, gif, jpeg, svg");if(t.size>2097152)return void alert("Размер файла не должен превышать 2 мб");const n=new FormData;n.append("file_attach",e.files[0]),o("/",n).then(e=>{console.log("успешная отправка");let t=new FormData;t.append("get_data_user",""),fetch("/",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){console.log(e.ava),document.querySelector(".login__avatar--img").removeAttribute("src"),document.querySelector(".login__avatar--img").setAttribute("src",e.ava+"?"+Math.random())}))}).catch(()=>console.log("отправка не удалась"))},o=async(e,t)=>{console.log("в процессе");let n=await fetch(e,{method:"POST",body:t});return await n.text()}});