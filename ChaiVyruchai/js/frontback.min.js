document.addEventListener("DOMContentLoaded",()=>{const e=document.getElementById("userPhoto"),t=document.getElementById("orgLogo"),s=document.getElementById("settings"),a=document.getElementById("org_add_with_user"),o=document.querySelector(".moderation-requests__list"),n=document.querySelector(".messages__list"),r=document.getElementById("form_message");function i(){let e=new FormData;e.append("load_messages",""),fetch("/",{method:"POST",body:e}).then((function(e){return e.json()})).then((function(e){console.log(e),e.forEach(e=>{console.log(e),""==e.ava&&(e.ava="img/admin/ava__adm1.jpeg"),n.insertAdjacentHTML("beforeend",'<li class="messages__item" message_id="'+e.message_id+'"><div class="messages__user"><div class="messages__user--avatar"><img class="messages__user--avatar-img" src="'+e.ava+'" alt="ava"></div><div class="messages__user--first_name">'+e.first_name+'</div><div class="messages__user--last_name">'+e.last_name+'</div><div class="messages__user--org_name">'+e.organization+'</div><div class="messages__user--role">Официант</div></div><div class="messages__text">'+e.message+' <span class="messages__date">'+e.date+'</span></div><div class="messages__status">\x3c!-- <button class="messages__btn btn-no">в работе</button> --\x3e<button class="messages__btn btn-yes" data-req="yes">выполнено</button></div></li>')})}))}o&&function(){let e=new FormData;e.append("load_moderations",""),fetch("/users",{method:"POST",body:e}).then((function(e){return e.json()})).then((function(e){e.forEach(e=>{console.log(e),""==e.ava&&(e.ava="img/admin/ava__adm1.jpeg"),o.insertAdjacentHTML("beforeend",'<li class="moderation-requests__item" user_id="'+e.user_id+'"><div class="moderation-requests__item--avatar"><img class="moderation-requests__item--avatar-img" src="'+e.ava+'" alt="ava"></div><div class="moderation-requests__item-block-name"><div class="moderation-requests__item--first_name">'+e.first_name+'</div><div class="moderation-requests__item--last_name">'+e.last_name+'</div><div class="moderation-requests__item--org_name">'+e.organization+'</div></div><div class="moderation-requests__item--role">Официант</div><div class="moderation-requests__item-block-btn"><button class="moderation-requests__item--yes" data-req="yes">да</button><button class="moderation-requests__item--no" data-req="no">нет</button></div></li>')})}))}(),n&&i(),s.onsubmit=async e=>{e.preventDefault();let t=await fetch("/",{method:"POST",body:new FormData(s)}),a=await t.json();if(s.reset(),"ok"==a.answer){let e=new FormData;e.append("get_data_user",""),fetch("/",{method:"POST",body:e}).then((function(e){return e.json()})).then((function(e){console.log(e.first_name),document.querySelector(".login__info--user-name").textContent=e.first_name}))}},r&&(r.onsubmit=async e=>{e.preventDefault();let t=await fetch("/",{method:"POST",body:new FormData(r)});await t.json();r.reset(),n.innerHTML="",i()}),a&&(a.onsubmit=async e=>{e.preventDefault();let t=await fetch("/organizations",{method:"POST",body:new FormData(a)});console.log(t);let s=await t.json();console.log(s),"ok"==s.answer&&a.reset()}),e.addEventListener("change",()=>{l(e.files[0]),console.log("Аватар загружен")}),t&&t.addEventListener("change",()=>{d(t.files[0]),console.log("Логотип загружен")}),o&&o.addEventListener("click",e=>{if(e.target.classList.contains("moderation-requests__item--yes"),"yes"==e.target.getAttribute("data-req")){e.target.closest("li").style.backgroundColor="rgba(111, 149, 145, 0.25)",e.target.closest("li").style.border="5px solid rgba(111, 149, 145, 0.25)",e.target.closest("li").style.padding="0";let t=new FormData;t.append("moderate_ok",e.target.closest("li").getAttribute("user_id")),fetch("/users",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){console.log(e)})),setTimeout(()=>e.target.closest("li").remove(),1e3)}if("no"==e.target.getAttribute("data-req")){e.target.closest("li").style.backgroundColor="rgba(202, 88, 62, 0.25)",e.target.closest("li").style.border="5px solid rgba(202, 88, 62, 0.25)",e.target.closest("li").style.padding="0";let t=new FormData;t.append("moderate_failure",e.target.closest("li").getAttribute("user_id")),fetch("/users",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){console.log(e)})),setTimeout(()=>e.target.closest("li").remove(),1e3)}}),n&&n.addEventListener("click",e=>{if(e.target.classList.contains("btn-yes"),"yes"==e.target.getAttribute("data-req")){e.target.closest("li").style.backgroundColor="rgba(111, 149, 145, 0.25)",e.target.closest("li").style.border="5px solid rgba(111, 149, 145, 0.25)",e.target.closest("li").style.padding="0";let t=new FormData;t.append("message_ok",e.target.closest("li").getAttribute("message_id")),fetch("/",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){console.log(e)})),setTimeout(()=>e.target.closest("li").remove(),1e3)}});const l=t=>{if(console.log(t.name),!["image/jpeg","image/png","image/gif","image/svg+xml"].includes(t.type))return void alert("Допустимы изображения png, gif, jpeg, svg");if(t.size>2097152)return void alert("Размер файла не должен превышать 2 мб");const s=new FormData;s.append("file_attach",e.files[0]),c("/",s).then(e=>{console.log("успешная отправка");let t=new FormData;t.append("get_data_user",""),fetch("/",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){console.log(e.ava),document.querySelector(".login__avatar--img").removeAttribute("src"),document.querySelector(".login__avatar--img").setAttribute("src",e.ava+"?"+Math.random())}))}).catch(()=>console.log("отправка не удалась"))},d=e=>{if(console.log(e.name),!["image/jpeg","image/png","image/gif","image/svg+xml"].includes(e.type))return void alert("Допустимы изображения png, gif, jpeg, svg");if(e.size>2097152)return void alert("Размер файла не должен превышать 2 мб");const s=new FormData;s.append("logo_attach",t.files[0]),c("/",s).then(e=>{console.log("успешная отправка");let t=new FormData;t.append("get_data_org",""),fetch("/",{method:"POST",body:t}).then((function(e){return e.json()})).then((function(e){console.log(e.logo),document.querySelector(".login__logo--img").removeAttribute("src"),document.querySelector(".login__logo--img").setAttribute("src",e.logo+"?"+Math.random())}))}).catch(()=>console.log("отправка не удалась"))},c=async(e,t)=>{console.log("в процессе");let s=await fetch(e,{method:"POST",body:t});return await s.text()}});